#  https://www.gnu.org/software/make/manual/make.pdf
#  https://www.gnu.org/software/make/manual/

THIS_FILE := $(lastword $(MAKEFILE_LIST))
.PHONY: help build up start down destroy stop restart logs logs-api ps login-timescale login-api db-shell
# Commands available for make:
#  https://question-it.com/questions/4885548/kak-poluchit-spisok-tselej-v-make-fajle
#  https://habr.com/ru/company/ruvds/blog/486682/

# Collect an image from docker-compose.yml
all: build up
dir_create:			;	mkdir -p /Users/mdulcie/Desktop/github/Inseption/inseption/SRCS/data/db
						mkdir -p /Users/mdulcie/Desktop/github/Inseption/inseption/SRCS/data/wordpress
						chmod -R 777 /Users/mdulcie/Desktop/github/Inseption/inseption/SRCS/data/
build:				;	docker-compose -f ./srcs/docker-compose-mac.yml build --no-cache
# build:				;	docker-compose -f ./srcs/docker-compose-mac.yml build
up:					;	docker-compose -f ./srcs/docker-compose-mac.yml up
start:				;	docker-compose -f ./srcs/docker-compose-mac.yml start
stop:				;	docker-compose -f ./srcs/docker-compose-mac.yml stop
down:				;	docker-compose -f ./srcs/docker-compose-mac.yml down
stop_down:			;	docker-compose -f ./srcs/docker-compose-mac.yml stop
						docker-compose -f ./srcs/docker-compose-mac.yml down

logs:				;	docker-compose -f ./srcs/docker-compose-mac.yml logs --tail=100 -f

logs-api:			;	docker-compose -f ./srcs/docker-compose-mac.yml logs --tail=100 -f api

ps:					;	docker ps

login-mdb:			;	docker exec -it mariadb bash
login-nginx:		;	docker exec -it nginx bash
login-wp:			;	docker exec -it wordpress bash

clean:				;	docker system prune -a
						rm -rf ./srcs/data/db/*
						rm -rf ./srcs/data/wordpress/*
						# docker volume rm $(docker volume ls -q --filter dangling=true)
						docker volume rm db
						docker volume rm wordpress1

ls-volume:			;	docker volume ls
ls-container:		;	docker container ls -a
ls-network:			;	docker network ls
ls-image:			;	docker image ls

re: clean all

help:				;	make -pRrq  -f $(THIS_FILE) : 2>/dev/null | awk -v RS= -F: '/^# File/,/^# Finished Make data base/ {if ($$1 !~ "^[#.]") {print $$1}}' | sort | egrep -v -e '^[^[:alnum:]]' -e '^$@$$'